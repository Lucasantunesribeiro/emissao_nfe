# Grafo de Depend√™ncias - Sistema NFe

**Data:** 2026-01-19
**Conta:** aws-old (212051644015)
**Regi√£o:** us-east-1

---

## üéØ WORKLOAD PRINCIPAL: Sistema NFe Serverless

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          USU√ÅRIO FINAL                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ HTTPS
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CloudFront Distribution                           ‚îÇ
‚îÇ                  d3065hze06690c.cloudfront.net                       ‚îÇ
‚îÇ                      (E2WP4QF7I5V84W)                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ                       ‚îÇ
                ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   S3 Frontend         ‚îÇ   ‚îÇ    API Gateway Endpoints                ‚îÇ
‚îÇ nfe-frontend-dev-*    ‚îÇ   ‚îÇ  (Proxy para Lambda Functions)          ‚îÇ
‚îÇ  (Angular App)        ‚îÇ   ‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ  - ApiEstoque (q99vlf2ppd)              ‚îÇ
                            ‚îÇ  - ApiFaturamento (r9d99rnsz6)          ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                          ‚îÇ
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ                   ‚îÇ                   ‚îÇ
                      ‚ñº                   ‚ñº                   ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ Lambda: Estoque   ‚îÇ ‚îÇ Lambda:         ‚îÇ ‚îÇ Lambda: Outbox   ‚îÇ
          ‚îÇ nfe-estoque-dev   ‚îÇ ‚îÇ Faturamento     ‚îÇ ‚îÇ Processor        ‚îÇ
          ‚îÇ   (.NET/C#)       ‚îÇ ‚îÇ nfe-fatur...-dev‚îÇ ‚îÇ nfe-outbox-...   ‚îÇ
          ‚îÇ   53.5 MB         ‚îÇ ‚îÇ   (Go)          ‚îÇ ‚îÇ   (Go)           ‚îÇ
          ‚îÇ   512 MB RAM      ‚îÇ ‚îÇ   5 MB          ‚îÇ ‚îÇ   256 MB RAM     ‚îÇ
          ‚îÇ   30s timeout     ‚îÇ ‚îÇ   512 MB RAM    ‚îÇ ‚îÇ   60s timeout    ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                    ‚îÇ                    ‚îÇ
                ‚îÇ VPC: vpc-0b5efd8a245fea948              ‚îÇ
                ‚îÇ SG: sg-08ea906a06ee802b4                ‚îÇ
                ‚îÇ                    ‚îÇ                    ‚îÇ
                ‚îÇ                    ‚îÇ                    ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ           ‚îÇ                    ‚îÇ                    ‚îÇ           ‚îÇ
    ‚îÇ           ‚ñº                    ‚ñº                    ‚ñº           ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
    ‚îÇ   ‚îÇ         RDS PostgreSQL: nfe-db-dev                 ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ       (db.t4g.micro, 20GB, PostgreSQL 16.4)        ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ  Endpoint: nfe-db-dev.cch2gou443t0...rds.aws...   ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ         Schemas: estoque, faturamento              ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ       SG: sg-03420f57f816cd889                     ‚îÇ       ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
    ‚îÇ                                                                 ‚îÇ
    ‚îÇ                  EVENT-DRIVEN COMMUNICATION                     ‚îÇ
    ‚îÇ                                                                 ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
    ‚îÇ   ‚îÇ          EventBridge Bus: nfe-events-dev            ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ          Archive: nfe-archive-dev                   ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ                                                     ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  Event Rules:                                       ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  - nfe-nota-criada-dev                             ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  - nfe-reserva-confirmada-dev                      ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  - nfe-reserva-falhou-dev                          ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  - nfe-outbox-processor-dev (trigger a cada 1min)  ‚îÇ      ‚îÇ
    ‚îÇ   ‚îÇ  - nfe-log-all-events-dev ‚Üí CloudWatch Logs        ‚îÇ      ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
    ‚îÇ           ‚îÇ                                                     ‚îÇ
    ‚îÇ           ‚îÇ Events                                              ‚îÇ
    ‚îÇ           ‚ñº                                                     ‚îÇ
    ‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
    ‚îÇ   ‚îÇ              SQS Queues                            ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ                                                    ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ  1. nfe-estoque-reserva-dev                       ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ     ‚Üí Consumer: Lambda Estoque                     ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ                                                    ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ  2. nfe-faturamento-confirmacao-dev               ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ     ‚Üí Consumer: Lambda Faturamento                 ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ                                                    ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ  3. nfe-dlq-dev (Dead Letter Queue)               ‚îÇ       ‚îÇ
    ‚îÇ   ‚îÇ                                                    ‚îÇ       ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
    ‚îÇ                                                                 ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     OBSERVABILIDADE                                  ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  CloudWatch Logs:                                                   ‚îÇ
‚îÇ  - /aws/lambda/nfe-estoque-dev                                      ‚îÇ
‚îÇ  - /aws/lambda/nfe-faturamento-dev                                  ‚îÇ
‚îÇ  - /aws/lambda/nfe-outbox-processor-dev                             ‚îÇ
‚îÇ  - /aws/events/nfe-dev                                              ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  CloudWatch Alarms: (configurados via CDK, status a verificar)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     SECURITY & SECRETS                               ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  Secrets Manager: (stack nfe-secrets-serverless-dev)                ‚îÇ
‚îÇ  - Database credentials                                             ‚îÇ
‚îÇ  - API keys (se houver)                                             ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  IAM Roles:                                                         ‚îÇ
‚îÇ  - LambdaExecutionRole (compartilhada por todas as Lambdas)         ‚îÇ
‚îÇ  - API Gateway CloudWatch Roles (2)                                 ‚îÇ
‚îÇ                                                                      ‚îÇ
‚îÇ  Security Groups:                                                   ‚îÇ
‚îÇ  - sg-08ea906a06ee802b4 (Lambda ‚Üí RDS, VPC endpoints)               ‚îÇ
‚îÇ  - sg-03420f57f816cd889 (RDS ingress)                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä FLUXO DE DADOS PRINCIPAL

### 1Ô∏è‚É£ Cria√ß√£o de Nota Fiscal:

```
Usu√°rio (Frontend)
  ‚Üí CloudFront
    ‚Üí S3 (Angular App carrega no browser)
      ‚Üí Browser faz requisi√ß√£o √† API
        ‚Üí API Gateway (ApiFaturamento)
          ‚Üí Lambda Faturamento
            ‚Üí RDS (insere nota na tabela faturamento.notas_fiscais)
            ‚Üí RDS (insere evento na tabela faturamento.outbox)
            ‚Üí Retorna sucesso para o usu√°rio

Outbox Processor (trigger a cada 1 minuto):
  ‚Üí Lambda Outbox Processor
    ‚Üí RDS (l√™ eventos pendentes da tabela outbox)
      ‚Üí EventBridge (publica evento "NotaFiscalCriada")
        ‚Üí EventBridge Rule "nfe-nota-criada-dev"
          ‚Üí SQS: nfe-estoque-reserva-dev
            ‚Üí Lambda Estoque (processa mensagem)
              ‚Üí Verifica estoque dispon√≠vel
              ‚Üí Se OK: publica "ReservaConfirmada" via EventBridge
              ‚Üí Se NOK: publica "ReservaFalhou" via EventBridge
```

### 2Ô∏è‚É£ Confirma√ß√£o de Reserva:

```
EventBridge (evento "ReservaConfirmada")
  ‚Üí EventBridge Rule "nfe-reserva-confirmada-dev"
    ‚Üí SQS: nfe-faturamento-confirmacao-dev
      ‚Üí Lambda Faturamento
        ‚Üí RDS (atualiza status da nota para "CONFIRMADA")
        ‚Üí Retorna OK
```

### 3Ô∏è‚É£ Consulta de Produtos/Notas:

```
Usu√°rio (Frontend)
  ‚Üí CloudFront
    ‚Üí Browser faz GET
      ‚Üí API Gateway (ApiEstoque ou ApiFaturamento)
        ‚Üí Lambda correspondente
          ‚Üí RDS (query no schema correspondente)
          ‚Üí Retorna dados para o frontend
```

---

## üîó DEPEND√äNCIAS POR RECURSO

### Lambda: nfe-estoque-dev

**Depende de:**
- ‚úÖ VPC: `vpc-0b5efd8a245fea948`
- ‚úÖ Subnets: `subnet-0ff7bcacd7528eda3`, `subnet-0a26241557fc9281c`
- ‚úÖ Security Group: `sg-08ea906a06ee802b4`
- ‚úÖ RDS: `nfe-db-dev` (schema: estoque)
- ‚úÖ SQS: `nfe-estoque-reserva-dev` (event source mapping)
- ‚úÖ EventBridge: `nfe-events-dev` (publica eventos)
- ‚úÖ IAM Role: `LambdaExecutionRoleD5C260-*`
- ‚úÖ CloudWatch Logs: `/aws/lambda/nfe-estoque-dev`
- ‚úÖ API Gateway: `ApiEstoque` (q99vlf2ppd)

**Conecta-se a (downstream):**
- EventBridge (publica ReservaConfirmada, ReservaFalhou)
- SQS Faturamento (indiretamente via EventBridge)

---

### Lambda: nfe-faturamento-dev

**Depende de:**
- ‚úÖ VPC: `vpc-0b5efd8a245fea948`
- ‚úÖ Subnets: `subnet-0ff7bcacd7528eda3`, `subnet-0a26241557fc9281c`
- ‚úÖ Security Group: `sg-08ea906a06ee802b4`
- ‚úÖ RDS: `nfe-db-dev` (schema: faturamento)
- ‚úÖ SQS: `nfe-faturamento-confirmacao-dev` (event source mapping)
- ‚úÖ SQS: `nfe-estoque-reserva-dev` (publica mensagens)
- ‚úÖ EventBridge: `nfe-events-dev` (publica eventos via outbox)
- ‚úÖ IAM Role: `LambdaExecutionRoleD5C260-*`
- ‚úÖ CloudWatch Logs: `/aws/lambda/nfe-faturamento-dev`
- ‚úÖ API Gateway: `ApiFaturamento` (r9d99rnsz6)

**Conecta-se a (downstream):**
- SQS Estoque (publica pedidos de reserva)
- RDS Outbox (escreve eventos para processamento)

---

### Lambda: nfe-outbox-processor-dev

**Depende de:**
- ‚úÖ VPC: `vpc-0b5efd8a245fea948`
- ‚úÖ Subnets: `subnet-0ff7bcacd7528eda3`, `subnet-0a26241557fc9281c`
- ‚úÖ Security Group: `sg-08ea906a06ee802b4`
- ‚úÖ RDS: `nfe-db-dev` (schema: faturamento.outbox)
- ‚úÖ EventBridge: `nfe-events-dev` (publica eventos processados)
- ‚úÖ EventBridge Rule: `nfe-outbox-processor-dev` (trigger a cada 1 min)
- ‚úÖ IAM Role: `LambdaExecutionRoleD5C260-*`
- ‚úÖ CloudWatch Logs: `/aws/lambda/nfe-outbox-processor-dev`

**Conecta-se a (downstream):**
- EventBridge (publica todos os eventos do outbox)

---

### RDS PostgreSQL: nfe-db-dev

**Depende de:**
- ‚úÖ VPC: `vpc-0b5efd8a245fea948`
- ‚úÖ DB Subnet Group: `nfe-database-serverless-dev-dbsubnetgroup-*`
- ‚úÖ Subnets: `subnet-0ff7bcacd7528eda3`, `subnet-0a26241557fc9281c`
- ‚úÖ Security Group: `sg-03420f57f816cd889`
- ‚úÖ KMS Key: `arn:aws:kms:us-east-1:212051644015:key/5c3920d1-b081-491a-95f8-1e4bc4b9001e`
- ‚úÖ DB Parameter Group: `nfe-database-serverless-dev-dbparametergroupd5340a4d-*`
- ‚úÖ Secrets Manager: (credenciais via stack nfe-secrets-serverless-dev)

**Conecta-se a (upstream):**
- Lambda Estoque
- Lambda Faturamento
- Lambda Outbox Processor

---

### API Gateway: ApiEstoque

**Depende de:**
- ‚úÖ Lambda: `nfe-estoque-dev` (backend integration)
- ‚úÖ CloudWatch Logs: (API Gateway logging)
- ‚úÖ IAM Role: `ApiEstoqueCloudWatchRoleC-*`

**Conecta-se a (upstream):**
- CloudFront (CORS origin: `https://d3065hze06690c.cloudfront.net`)

---

### API Gateway: ApiFaturamento

**Depende de:**
- ‚úÖ Lambda: `nfe-faturamento-dev` (backend integration)
- ‚úÖ CloudWatch Logs: (API Gateway logging)
- ‚úÖ IAM Role: `ApiFaturamentoCloudWatchRole5-*`

**Conecta-se a (upstream):**
- CloudFront (CORS origin: `https://d3065hze06690c.cloudfront.net`)

---

### CloudFront Distribution

**Depende de:**
- ‚úÖ S3 Bucket: `nfe-frontend-dev-212051644015` (origin)
- ‚úÖ OAI: `E1S3QHH5TX0NF0` (Origin Access Identity)
- ‚úÖ Cache Policies: HTML e Assets
- ‚úÖ API Gateway: Endpoints Estoque e Faturamento (via proxy paths, se configurado)

**Conecta-se a (upstream):**
- Usu√°rios finais (p√∫blico)

---

### EventBridge Bus: nfe-events-dev

**Depende de:**
- ‚úÖ EventBridge Archive: `nfe-archive-dev`
- ‚úÖ CloudWatch Logs: `/aws/events/nfe-dev`
- ‚úÖ Event Rules (5 rules configuradas)

**Conecta-se a:**
- SQS Queues (via rules)
- Lambda Outbox Processor (via rules)
- CloudWatch Logs (logging)

---

### SQS Queues

**nfe-estoque-reserva-dev:**
- Consumer: Lambda Estoque (event source mapping)
- DLQ: `nfe-dlq-dev`

**nfe-faturamento-confirmacao-dev:**
- Consumer: Lambda Faturamento (event source mapping)
- DLQ: `nfe-dlq-dev`

**nfe-dlq-dev:**
- Uso: Armazena mensagens que falharam ap√≥s N tentativas

---

## üéØ ORDEM DE CRIA√á√ÉO DE RECURSOS (para migra√ß√£o)

### Stack de Depend√™ncias (ordem obrigat√≥ria):

```
1. SECRETS (nfe-secrets-serverless-dev)
   ‚îî‚îÄ> Secrets Manager com credenciais do DB

2. NETWORK (nfe-network-serverless-dev)
   ‚îú‚îÄ> VPC
   ‚îú‚îÄ> Subnets
   ‚îî‚îÄ> Security Groups

3. MESSAGING (nfe-messaging-serverless-dev)
   ‚îú‚îÄ> EventBridge Bus
   ‚îú‚îÄ> EventBridge Archive
   ‚îú‚îÄ> CloudWatch Logs
   ‚îî‚îÄ> EventBridge Rules (b√°sicas)

4. DATABASE (nfe-database-serverless-dev)
   ‚îú‚îÄ> DB Subnet Group (depende: Network)
   ‚îú‚îÄ> RDS Instance (depende: Network, Secrets)
   ‚îî‚îÄ> Schemas criados via migration scripts

5. COMPUTE (nfe-compute-serverless-dev)
   ‚îú‚îÄ> IAM Roles
   ‚îú‚îÄ> Lambda Functions (depende: Network, Database, Secrets)
   ‚îú‚îÄ> API Gateway (depende: Lambda)
   ‚îú‚îÄ> SQS Queues
   ‚îú‚îÄ> Event Source Mappings (Lambda ‚Üê SQS)
   ‚îî‚îÄ> EventBridge Rules completas (depende: Lambda, SQS)

6. FRONTEND (nfe-frontend-serverless-dev)
   ‚îú‚îÄ> S3 Bucket
   ‚îú‚îÄ> CloudFront Distribution (depende: S3, API Gateway URLs)
   ‚îî‚îÄ> Deploy do Angular app no S3
```

---

## üîç PONTOS CR√çTICOS PARA MIGRA√á√ÉO

### ‚ö†Ô∏è Dados Persistentes (CR√çTICO):

1. **RDS PostgreSQL** (`nfe-db-dev`)
   - **Migra√ß√£o:** Snapshot ‚Üí Compartilhar ‚Üí Restaurar na aws-new
   - **Downtime:** Sim (durante restore + cutover)
   - **Valida√ß√£o:** Comparar row counts, checksums

2. **EventBridge Archive** (`nfe-archive-dev`)
   - **Migra√ß√£o:** Replay events se necess√°rio
   - **Downtime:** N√£o (pode recriar vazio)

3. **SQS Messages in-flight**
   - **Migra√ß√£o:** Drenar filas antes do cutover
   - **Downtime:** Sim (pausar processamento)

### ‚ö†Ô∏è Configura√ß√µes Hardcoded:

1. **CORS_ORIGINS** nas Lambdas:
   - Atual: `https://d3065hze06690c.cloudfront.net`
   - **A√ß√£o:** Atualizar com novo CloudFront domain ap√≥s deploy

2. **Database Connection Strings** nas Lambdas:
   - Atual: `nfe-db-dev.cch2gou443t0.us-east-1.rds.amazonaws.com`
   - **A√ß√£o:** Atualizar com novo RDS endpoint

3. **SQS URLs** nas Lambdas:
   - Atual: `https://sqs.us-east-1.amazonaws.com/212051644015/...`
   - **A√ß√£o:** Atualizar com novos SQS URLs (novo account ID)

4. **EventBridge Bus Name**:
   - Atual: `nfe-events-dev`
   - **A√ß√£o:** Manter mesmo nome ou atualizar c√≥digo

### ‚ö†Ô∏è Recursos que N√ÉO podem ser movidos:

- ‚ùå Lambda Functions (recriar na aws-new)
- ‚ùå API Gateway (recriar na aws-new)
- ‚ùå EventBridge Bus (recriar na aws-new)
- ‚ùå SQS Queues (recriar na aws-new)
- ‚ùå CloudFront Distribution (recriar na aws-new, novo domain)
- ‚ùå S3 Bucket (recriar e copiar objetos)

### ‚úÖ Recursos que PODEM ser movidos/copiados:

- ‚úÖ RDS Snapshot (compartilhar entre contas)
- ‚úÖ S3 Objects (sync entre buckets)
- ‚úÖ C√≥digo das Lambdas (zip files no CDK assets bucket)
- ‚úÖ CloudFormation Templates (IaC local)

---

## üí∞ ESTIMATIVA DE CUSTO P√ìS-MIGRA√á√ÉO (aws-new)

**Premissa:** Mesmo ambiente (dev), mesma configura√ß√£o

| Servi√ßo | Recurso | Custo Mensal |
|---------|---------|--------------|
| RDS | db.t4g.micro (20GB gp3, Single-AZ) | ~$15 |
| Lambda | 3 functions, baixo tr√°fego dev | ~$5-10 |
| API Gateway | 2 APIs, baixo tr√°fego | ~$1 |
| EventBridge | Custom bus + rules | ~$1 |
| SQS | 3 queues, baixo volume | ~$0.50 |
| S3 | Frontend bucket (<1GB) | ~$0.25 |
| CloudFront | Baixo tr√°fego dev | ~$1 |
| Data Transfer | M√≠nimo | ~$1 |
| **TOTAL** | | **~$24-29/m√™s** |

**Custo adicional tempor√°rio durante migra√ß√£o:**
- RDS Snapshot storage: ~$0.10/GB/m√™s √ó 20GB = ~$2/m√™s (manter por 30 dias)

---

## üöÄ PR√ìXIMO PASSO: Classifica√ß√£o de Recursos

Avan√ßar para **FASE 1.4**: Classificar cada recurso como:
- **MIGRAR** (essencial para o workload)
- **PAUSAR** (temporariamente desligar)
- **DECOMISSIONAR** (deletar ap√≥s migra√ß√£o)
- **MANTER** (deixar na conta antiga, ex: EmailTriageAI EC2)
